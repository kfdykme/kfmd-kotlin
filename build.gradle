/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Kotlin library project to get you started.
 */

plugins {
    // Apply the Kotlin JVM plugin to add support for Kotlin on the JVM.
    id 'org.jetbrains.kotlin.jvm' version '1.3.21'
}

repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

dependencies {
    // Use the Kotlin JDK 8 standard library.
    implementation 'org.jetbrains.kotlin:kotlin-stdlib-jdk8'

    // Use the Kotlin test library.
    testImplementation 'org.jetbrains.kotlin:kotlin-test'

    // Use the Kotlin JUnit integration.
    testImplementation 'org.jetbrains.kotlin:kotlin-test-junit'
}

task copyKotlin(type: Copy, group: 'custom') {

    doFirst {
        println 'task: copyKoltin'
    }
    from 'core/src'
    into 'build/source/src'

    doLast {
        println 'copyKotlin successfully'
    }
}

task copyJs(type: Copy, group: 'custom') {
    from 'kfmd-js/src'
    into 'build/source/src'
}


task complieKotlin (type: Exec, group: 'custom') {
    workingDir '.'
    commandLine 'kotlinc', "build/source", '-d', 'out/kotlin/kfmdls' +
            ''

}

task complieJs (type: Exec, group: 'custom') {
    workingDir '.'
    commandLine 'kotlinc-js', '-output', 'out/js/lib.js' , "build/source", '-module-kind', 'commonjs'
}

task cleanBuild ( group: 'custom'){
    doFirst {
        println 'task: cleanBuild'
    }

    new File('./build').deleteDir()
//
    doLast {
        println 'cleanBuild successfully'
    }
}

task buildKotlin() {
    dependsOn cleanBuild
    dependsOn copyKotlin
    dependsOn complieKotlin
    tasks.findByName('copyKotlin').mustRunAfter 'cleanBuild'
    tasks.findByName('complieKotlin').mustRunAfter 'copyKotlin'
}

task buildJs () {
    dependsOn cleanBuild
    dependsOn copyKotlin
    dependsOn copyJs
    dependsOn complieJs
    tasks.findByName('copyKotlin').mustRunAfter 'cleanBuild'
    tasks.findByName('copyJs').mustRunAfter 'copyKotlin'
    tasks.findByName('complieJs').mustRunAfter 'copyJs'
}